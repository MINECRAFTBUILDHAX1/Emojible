<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emojible</title>
    <style>
        /* Add your existing styles here */
    </style>
</head>

<body>
    <!-- Help Icon -->
    <div class="help-icon" onclick="showHelp()">&#63;</div>
    
    <div id="game-container">
        <h1>Welcome to Emojible!</h1>
        <div id="emoji-puzzle">
            <!-- Emoji puzzle will go here -->
        </div>
        <input type="text" id="answer-input" placeholder="Type your answer..." />
        <button id="submit-btn">Submit</button>
        <p id="message"></p>
        <div id="progress-bar-container">
            <div id="progress-bar"></div>
        </div>
        <p id="next-puzzle-message"></p> <!-- Come back tomorrow message -->
    </div>
    
    <!-- Help Popup -->
    <div id="help-popup" class="help-popup">
        <div class="popup-content">
            <h2>Help</h2>
            <p>The progress bar shows if your answer is correct:</p>
            <ul>
                <li>Fully green and "Correct!" means your answer is almost there, but it may have too many letters.</li>
            </ul>
            <button onclick="closeHelp()">Close</button>
        </div>
    </div>
    
    <!-- Footer -->
    <footer>
        <ul>
            <li><a href="privacy.html" target="_blank">Privacy Notice</a></li>
            <li><a href="terms.html" target="_blank">Terms of Service</a></li>
            <li><a href="mailto:mmajcherczykolczak@gmail.com?subject=Enquiry%20about%20Emojible">Contact</a></li>
        </ul>
    </footer>        

    <script>
        const puzzles = [
            { emoji: 'ü¶Åüëë', answer: 'The Lion King' }
        ];

        let currentPuzzle = 0;

        function calculateProgress(userAnswer, correctAnswer) {
            const userAnswerLower = userAnswer.toLowerCase();
            const correctAnswerLower = correctAnswer.toLowerCase();
            let similarity = 0;

            for (let i = 0; i < Math.min(userAnswerLower.length, correctAnswerLower.length); i++) {
                if (userAnswerLower[i] === correctAnswerLower[i]) {
                    similarity++;
                }
            }

            return (similarity / correctAnswerLower.length) * 100;
        }

        function updateProgressBar(progress, message) {
            const progressBar = document.getElementById('progress-bar');
            progressBar.style.width = `${progress}%`;

            if (progress === 100) {
                progressBar.style.backgroundColor = 'green';
                document.getElementById('message').textContent = 'Correct! üéâ';
            } else if (progress >= 50) {
                progressBar.style.backgroundColor = 'orange';
                document.getElementById('message').textContent = message || 'Almost there!';
            } else {
                progressBar.style.backgroundColor = 'red';
                document.getElementById('message').textContent = 'Try again! ‚ùå';
            }
        }

        function submitAnswer() {
            const userAnswer = document.getElementById('answer-input').value.trim();
            const correctAnswer = puzzles[currentPuzzle].answer;

            if (!userAnswer) {
                updateProgressBar(0, 'Try again! ‚ùå');
                return;
            }

            const progress = calculateProgress(userAnswer, correctAnswer);
            updateProgressBar(progress);

            if (userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
                localStorage.setItem('puzzleCompletedTime', Date.now().toString());
                disablePuzzle(24 * 60 * 60 * 1000); // Start 24-hour timer
            }
        }

        document.getElementById('submit-btn').addEventListener('click', submitAnswer);

        // Allow Enter key to submit answer
        document.getElementById('answer-input').addEventListener('keypress', function (event) {
            if (event.key === 'Enter') {
                submitAnswer();
            }
        });

        // Disable input and button, and show timer
        function disablePuzzle(remainingTime) {
            document.getElementById('answer-input').disabled = true;
            document.getElementById('submit-btn').disabled = true;
            document.getElementById('next-puzzle-message').textContent = 'Next puzzle in: ';
            const countdownElement = document.createElement('span');
            document.getElementById('next-puzzle-message').appendChild(countdownElement);

            function updateTimer() {
                const hours = Math.floor(remainingTime / (1000 * 60 * 60));
                const minutes = Math.floor((remainingTime % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((remainingTime % (1000 * 60)) / 1000);
                countdownElement.textContent = `${hours}h ${minutes}m ${seconds}s`;

                if (remainingTime > 0) {
                    remainingTime -= 1000;
                    setTimeout(updateTimer, 1000);
                } else {
                    localStorage.removeItem('puzzleCompletedTime');
                    location.reload(); // Reload to unlock the puzzle
                }
            }
            updateTimer();
        }

        // Check if the puzzle has been completed before
        function checkIfPuzzleCompleted() {
            const completedTime = localStorage.getItem('puzzleCompletedTime');
            if (completedTime) {
                const timePassed = Date.now() - parseInt(completedTime, 10);
                const remainingTime = 24 * 60 * 60 * 1000 - timePassed;

                if (remainingTime > 0) {
                    disablePuzzle(remainingTime);
                    return;
                } else {
                    localStorage.removeItem('puzzleCompletedTime'); // Reset for the new day
                }
            }
            loadPuzzle();
        }

        // Get today's puzzle
        function getTodayPuzzle() {
            const currentDate = new Date().toLocaleDateString();
            const storedDate = localStorage.getItem('currentDate');

            if (storedDate !== currentDate) {
                localStorage.setItem('puzzleIndex', Math.floor(Math.random() * puzzles.length));
                storeTodayPuzzle();
            }
        }

        // Store today's date in localStorage
        function storeTodayPuzzle() {
            const currentDate = new Date().toLocaleDateString();
            localStorage.setItem('currentDate', currentDate);
        }

        // Load puzzle based on stored index
        function loadPuzzle() {
            const puzzle = puzzles[getPuzzleIndex()];
            document.getElementById('emoji-puzzle').textContent = puzzle.emoji;
            document.getElementById('answer-input').value = '';
            document.getElementById('message').textContent = '';
            document.getElementById('progress-bar').style.width = '0%';
            document.getElementById('next-puzzle-message').textContent = '';
        }

        function getPuzzleIndex() {
            return localStorage.getItem('puzzleIndex') || 0;
        }

        window.onload = function () {
            getTodayPuzzle();
            checkIfPuzzleCompleted();
        };

        function showHelp() {
            document.getElementById('help-popup').style.display = 'flex';
        }

        function closeHelp() {
            document.getElementById('help-popup').style.display = 'none';
        }
    </script>
</body>

</html>
